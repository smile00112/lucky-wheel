# Локальное тестирование виджета

## Быстрый старт

### 1. Запустите Laravel сервер

```bash
php artisan serve
```

Сервер запустится на `http://localhost:8000`

### 2. Создайте активное колесо

1. Откройте админ-панель: `http://localhost:8000/admin`
2. Создайте новое колесо
3. Установите `is_active = true`
4. Запомните `slug` колеса (например: `summer-promo`)
5. Добавьте призы с вероятностями

### 3. Откройте тестовую страницу

#### Вариант 1: Полнофункциональная тестовая страница (рекомендуется)

Откройте в браузере:
```
http://localhost:8000/test-widget.html
```

Эта страница включает:
- ✅ Панель настроек (можно менять API URL и slug)
- ✅ Лог событий в реальном времени
- ✅ Автоматическое определение локального URL
- ✅ Обработка всех событий виджета
- ✅ Кнопки для управления виджетом

**Как использовать:**
1. В поле "Slug колеса" введите slug вашего колеса
2. Проверьте, что API URL правильный (обычно `http://localhost:8000/api/widget`)
3. Нажмите "Загрузить виджет"
4. Смотрите логи в панели внизу страницы

#### Вариант 2: Простой пример

Откройте в браузере:
```
http://localhost:8000/widget-example.html
```

**Перед использованием:**
1. Откройте файл `public/widget-example.html` в редакторе
2. Найдите строку: `const wheelSlug = 'your-wheel-slug';`
3. Замените `'your-wheel-slug'` на реальный slug вашего колеса
4. Сохраните файл
5. Обновите страницу в браузере

### 4. Откройте консоль браузера

Нажмите `F12` или `Ctrl+Shift+I` (Windows/Linux) / `Cmd+Option+I` (Mac) для открытия Developer Tools.

В консоли вы увидите:
- Логи загрузки виджета
- События вращения
- Выигрыши
- Ошибки (если есть)

## Проверка файлов

Убедитесь, что файлы доступны:

1. **JavaScript виджет:**
   ```
   http://localhost:8000/js/lucky-wheel-widget.js
   ```
   Должен открыться файл, а не 404 ошибка

2. **API endpoint:**
   ```
   http://localhost:8000/api/widget/wheel/YOUR-SLUG
   ```
   Замените `YOUR-SLUG` на реальный slug. Должен вернуться JSON с данными колеса.

3. **Виджет embed:**
   ```
   http://localhost:8000/widget/embed/YOUR-SLUG?guest_id=1
   ```
   Должна открыться страница с колесом.

## Типичные проблемы

### Виджет не загружается

**Проблема:** Виджет не появляется или показывает ошибку

**Решения:**
1. Проверьте консоль браузера (F12) на наличие ошибок
2. Убедитесь, что slug колеса правильный
3. Проверьте, что колесо активно (`is_active = true`)
4. Убедитесь, что сервер Laravel запущен

### Ошибка CORS

**Проблема:** В консоли появляется ошибка CORS

**Решения:**
1. Убедитесь, что middleware `WidgetCors` подключен в `bootstrap/app.php`
2. Проверьте, что вы используете правильный URL (не `file://`, а `http://localhost:8000`)
3. Очистите кэш: `php artisan config:clear`

### "Wheel not found"

**Проблема:** Виджет показывает ошибку "Wheel not found"

**Решения:**
1. Проверьте, что slug указан правильно
2. Убедитесь, что колесо активно в админ-панели
3. Проверьте временные ограничения (`starts_at`, `ends_at`)

### "Guest not found" или проблемы с гостем

**Проблема:** Ошибки связанные с гостем

**Решения:**
1. Очистите localStorage в браузере (F12 → Application → Local Storage → очистить)
2. Проверьте, что API endpoint `/api/widget/guest` работает
3. Проверьте консоль на ошибки запросов

### Виджет не вращается

**Проблема:** Кнопка "Крутить колесо" не работает

**Решения:**
1. Проверьте консоль на ошибки
2. Убедитесь, что API endpoint `/api/widget/spin` доступен
3. Проверьте лимиты вращений (возможно, лимит исчерпан)
4. Проверьте, что есть активные призы

## Отладка

### Проверка сетевых запросов

1. Откройте Developer Tools (F12)
2. Перейдите на вкладку "Network"
3. Попробуйте выполнить вращение
4. Проверьте запросы:
   - `POST /api/widget/spin` - должен вернуть 200
   - `GET /api/widget/wheel/{slug}` - должен вернуть JSON
   - `GET /widget/embed/{slug}` - должен вернуть HTML

### Проверка localStorage

1. Откройте Developer Tools (F12)
2. Перейдите на вкладку "Application" → "Local Storage"
3. Найдите ключ `lucky_wheel_guest_id`
4. Это ID гостя, созданного виджетом

### Проверка данных колеса

Откройте в браузере:
```
http://localhost:8000/api/widget/wheel/YOUR-SLUG
```

Должен вернуться JSON вида:
```json
{
  "id": 1,
  "name": "Колесо фортуны",
  "description": "...",
  "slug": "your-slug",
  "spins_limit": null,
  "prizes": [...]
}
```

## Тестирование на другом порту

Если ваш сервер работает на другом порту (например, 8080):

1. В тестовой странице измените API URL:
   ```
   http://localhost:8080/api/widget
   ```

2. Или используйте переменную окружения в `.env`:
   ```
   APP_URL=http://localhost:8080
   ```

## Тестирование на разных доменах

Для тестирования CORS:

1. Создайте простой HTML файл на другом домене/порту
2. Подключите виджет с указанием полного URL:
   ```javascript
   LuckyWheel.init({
     slug: 'your-slug',
     apiUrl: 'http://localhost:8000/api/widget',
     // ...
   });
   ```

## Полезные команды

```bash
# Очистка кэша
php artisan config:clear
php artisan cache:clear
php artisan route:clear

# Просмотр маршрутов
php artisan route:list | grep widget

# Запуск сервера на другом порту
php artisan serve --port=8080

# Просмотр логов
tail -f storage/logs/laravel.log
```

## Готово!

После успешного тестирования на локальной машине вы можете:
1. Развернуть на продакшн сервере
2. Встроить виджет на реальный сайт
3. Использовать на любом внешнем сайте

