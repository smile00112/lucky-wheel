@php
    $defaultTexts = [
        'loading_text' => 'Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°...',
        'spin_button_text' => 'ÐšÑ€ÑƒÑ‚Ð¸Ñ‚ÑŒ ÐºÐ¾Ð»ÐµÑÐ¾!',
        'spin_button_blocked_text' => 'Ð’Ñ‹ ÑƒÐ¶Ðµ Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð»Ð¸ ÑÐµÐ³Ð¾Ð´Ð½Ñ. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð·Ð°Ð²Ñ‚Ñ€Ð°!',
        'won_prize_label' => 'Ð’Ñ‹Ð¸Ð³Ñ€Ð°Ð½Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ:',
        'win_notification_title' => 'ðŸŽ‰ ÐŸÐ¾Ð·Ð´Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ñ Ð²Ñ‹Ð¸Ð³Ñ€Ñ‹ÑˆÐµÐ¼!',
        'win_notification_win_text' => 'Ð’Ñ‹ Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð»Ð¸:',
        'copy_code_button_title' => 'ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð´',
        'code_not_specified' => 'ÐšÐ¾Ð´ Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½',
        'download_pdf_text' => 'Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ PDF',
        'form_description' => 'Ð”Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¸Ð·Ð° Ð½Ð° Ð¿Ð¾Ñ‡Ñ‚Ñƒ Ð·Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:',
        'form_name_placeholder' => 'Ð’Ð°ÑˆÐµ Ð¸Ð¼Ñ',
        'form_email_placeholder' => 'Email',
        'form_phone_placeholder' => '+7 (XXX) XXX-XX-XX',
        'form_submit_text' => 'ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð·',
        'form_submit_loading' => 'ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ°...',
        'form_submit_success' => 'âœ“ ÐŸÑ€Ð¸Ð· Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½!',
        'form_submit_error' => 'ÐŸÑ€Ð¸Ð· ÑƒÐ¶Ðµ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½',
        'form_success_message' => 'âœ“ Ð”Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹! ÐŸÑ€Ð¸Ð· Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½ Ð½Ð° ÑƒÐºÐ°Ð·Ð°Ð½Ð½ÑƒÑŽ Ð¿Ð¾Ñ‡Ñ‚Ñƒ.',
        'prize_image_alt' => 'ÐŸÑ€Ð¸Ð·',
        'spins_info_format' => 'Ð’Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¹: {count} / {limit}',
        'spins_limit_format' => 'Ð›Ð¸Ð¼Ð¸Ñ‚ Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ð¹: {limit}',
        'error_init_guest' => 'ÐžÑˆÐ¸Ð±ÐºÐ° Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸: Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð³Ð¾ÑÑ‚Ñ',
        'error_init' => 'ÐžÑˆÐ¸Ð±ÐºÐ° Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸:',
        'error_no_prizes' => 'ÐÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ñ… Ð¿Ñ€Ð¸Ð·Ð¾Ð²',
        'error_load_data' => 'ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…:',
        'error_spin' => 'ÐŸÑ€Ð¸ Ñ€Ð¾Ð·Ñ‹Ð³Ñ€Ñ‹ÑˆÐµ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð¾ÑˆÐ¸Ð±ÐºÐ°! ÐžÐ±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ð² Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÑƒ ÑÐµÑ€Ð²Ð¸ÑÐ°.',
        'error_general' => 'ÐžÑˆÐ¸Ð±ÐºÐ°:',
        'error_send' => 'ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐµ',
        'error_copy_code' => 'ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð´. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ:',
        'wheel_default_name' => 'ÐšÐ¾Ð»ÐµÑÐ¾ Ð¤Ð¾Ñ€Ñ‚ÑƒÐ½Ñ‹',
    ];
    $settings = $wheel->settings ?? [];
    $texts = array_merge($defaultTexts, $settings);
    $guestData = $guest ? [
        'id' => $guest->id,
        'name' => $guest->name,
        'email' => $guest->email,
        'phone' => $guest->phone,
    ] : null;
@endphp

<link rel="stylesheet" href="{{ url('css/widget/wheel.css') }}">

<style>
{!! $wheel->generateStyleCss() !!}
</style>

<div class="lucky-wheel-content">
<div class="lucky-wheel-container">
    <h1>ðŸŽ¡ {{ $wheel->name ?? $texts['wheel_default_name'] }}</h1>
    @if($wheel->description)
        <div class="description">{{ $wheel->description }}</div>
    @endif

    <div id="loading" class="loading">{{ $texts['loading_text'] }}</div>

    <div id="wheelContent" style="display: none;">
        <div class="wheel-container">
            <div class="pointer"></div>
            <canvas id="wheelCanvas" class="wheel"></canvas>
            <div id="wonPrizeBlock" class="won-prize-block" style="display: none;">
                <div class="won-prize-label">{{ $texts['won_prize_label'] }}</div>
                <div class="won-prize-name" id="wonPrizeCode"></div>
            </div>
        </div>

        <button id="spinButton" class="spin-button">{{ $texts['spin_button_text'] }}</button>
        <div id="spinsInfo" class="spins-info"></div>
    </div>

    <div id="error" class="error"></div>
</div>

<div id="winNotification" class="win-notification" style="display: none;">
    <button class="win-notification-close">&times;</button>
    <h3>{{ $texts['win_notification_title'] }}</h3>
    <div class="win-notification-message" id="winNotificationMessage"></div>
    <div class="win-notification-code" id="winNotificationCodeContainer">
        <input type="text" id="winNotificationCode" readonly value="">
        <button title="{{ $texts['copy_code_button_title'] }}">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
            </svg>
        </button>
    </div>

    <a href="#" id="winNotificationPdfLink" class="win-notification-pdf-link" style="display: none;" target="_blank">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
        </svg>
        <span>{{ $texts['download_pdf_text'] }}</span>
    </a>

    <div class="win-notification-form" id="winNotificationFormContainer" style="display: none;">
        <p class="win-notification-form-text">{{ $texts['form_description'] }}</p>
        <form id="winNotificationForm">
            <div class="win-notification-form-group">
                <input type="text" id="winNotificationName" name="name" placeholder="{{ $texts['form_name_placeholder'] }}" required>
            </div>
            <div class="win-notification-form-group">
                <input type="email" id="winNotificationEmail" name="email" placeholder="{{ $texts['form_email_placeholder'] }}" required>
            </div>
            <div class="win-notification-form-group">
                <input type="tel" id="winNotificationPhone" name="phone" placeholder="{{ $texts['form_phone_placeholder'] }}" required maxlength="18">
            </div>
            <button type="submit" class="win-notification-submit-btn" id="winNotificationSubmitBtn">
                {{ $texts['form_submit_text'] }}
            </button>
        </form>
    </div>

    <div class="win-notification-send-container" id="winNotificationSendContainer" style="display: none;">
        <button type="button" class="win-notification-submit-btn" id="winNotificationSubmitBtn2">
            {{ $texts['form_submit_text'] }}
        </button>
    </div>

    <div class="win-notification-image-container" id="winNotificationImageContainer" style="display: none;">
        <img id="winNotificationImage" src="" alt="{{ $texts['prize_image_alt'] }}">
    </div>
</div>
</div>

<script>
    window.API_URL = '{{ url("/api/widget") }}';
    window.APP_URL = '{{ url('/') }}';
    window.WHEEL_SLUG = '{{ $wheel->slug }}';
    window.WHEEL_TEXTS = @json($texts);
    window.GUEST_DATA = @json($guestData);
</script>

<script type="module" src="{{ route('widget.assets', ['path' => 'app.js']) }}"></script>

